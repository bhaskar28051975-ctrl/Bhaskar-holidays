<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Driver Page - Bhaskar Holidays</title>
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700;900&family=DM+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    :root { --primary: #e8730a; --dark: #1a1a2e; --light: #fff8f0; --muted: #64748b; --border: #ffe0c0; }
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body { font-family: 'DM Sans', sans-serif; background: var(--light); min-height: 100vh; color: var(--dark); }

    /* HEADER */
    .header {
      background: linear-gradient(135deg, var(--dark) 0%, #0f3460 100%);
      padding: 2.5rem 5%; color: #fff;
      position: relative; overflow: hidden;
    }
    .header::before {
      content: ''; position: absolute; inset: 0;
      background: url('https://images.unsplash.com/photo-1512343879784-a960bf40e7f2?w=1200') center/cover;
      opacity: 0.1;
    }
    .header-content { position: relative; max-width: 800px; margin: 0 auto; text-align: center; }
    .brand { font-family: 'Playfair Display', serif; font-size: 1.1rem; color: rgba(255,255,255,0.6); margin-bottom: 1.5rem; letter-spacing: 1px; }
    .brand span { color: var(--primary); }

    /* DRIVER PROFILE */
    .driver-profile {
      display: flex; flex-direction: column; align-items: center; gap: 1rem;
    }
    .driver-avatar-wrap {
      position: relative;
    }
    .driver-avatar {
      width: 110px; height: 110px; border-radius: 50%;
      border: 4px solid var(--primary);
      object-fit: cover; background: #f0e6d6;
      box-shadow: 0 8px 32px rgba(0,0,0,0.3);
    }
    .driver-verified {
      position: absolute; bottom: 4px; right: 4px;
      background: var(--primary); color: #fff;
      border-radius: 50%; width: 26px; height: 26px;
      display: flex; align-items: center; justify-content: center;
      font-size: 14px; border: 2px solid #fff;
    }
    .driver-name { font-family: 'Playfair Display', serif; font-size: 2rem; }
    .driver-tagline { color: rgba(255,255,255,0.7); font-size: 0.95rem; }
    .driver-badges { display: flex; gap: 0.75rem; flex-wrap: wrap; justify-content: center; margin-top: 0.5rem; }
    .badge { background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); color: #fff; padding: 5px 14px; border-radius: 20px; font-size: 0.82rem; font-weight: 600; }
    .badge.primary { background: var(--primary); border-color: var(--primary); }

    /* MAIN */
    .main { max-width: 800px; margin: 0 auto; padding: 2rem 5%; }

    /* TAXI CARD */
    .taxi-showcase {
      background: #fff; border-radius: 20px;
      border: 1px solid var(--border);
      box-shadow: 0 4px 24px rgba(0,0,0,0.07);
      overflow: hidden; margin-bottom: 1.5rem;
    }
    .taxi-img-gallery { position: relative; height: 220px; background: #f0e6d6; }
    .taxi-img-gallery img { width: 100%; height: 100%; object-fit: cover; }
    .taxi-info { padding: 1.5rem; }
    .taxi-info-title { font-family: 'Playfair Display', serif; font-size: 1.3rem; color: var(--dark); margin-bottom: 1rem; }
    .taxi-specs { display: grid; grid-template-columns: repeat(3, 1fr); gap: 1rem; }
    .spec { text-align: center; padding: 1rem; background: var(--light); border-radius: 12px; border: 1px solid var(--border); }
    .spec-icon { font-size: 1.5rem; margin-bottom: 0.25rem; }
    .spec-value { font-weight: 700; color: var(--dark); font-size: 0.95rem; }
    .spec-label { color: var(--muted); font-size: 0.78rem; }
    .taxi-number-plate {
      margin-top: 1rem; background: var(--dark); color: #fff;
      padding: 0.6rem 1.2rem; border-radius: 8px;
      font-weight: 700; font-size: 1rem; display: inline-block;
      letter-spacing: 2px;
    }

    /* PACKAGES */
    .section-title {
      font-family: 'Playfair Display', serif; font-size: 1.4rem;
      color: var(--dark); margin-bottom: 1rem;
      display: flex; align-items: center; gap: 0.5rem;
    }
    .pkg-list { display: flex; flex-direction: column; gap: 1rem; margin-bottom: 1.5rem; }
    .pkg-row {
      background: #fff; border-radius: 14px; padding: 1rem 1.2rem;
      border: 1px solid var(--border); display: flex;
      align-items: center; gap: 1rem;
      box-shadow: 0 2px 8px rgba(0,0,0,0.04);
      transition: transform 0.2s, box-shadow 0.2s;
    }
    .pkg-row:hover { transform: translateY(-2px); box-shadow: 0 6px 20px rgba(232,115,10,0.1); }
    .pkg-row-img { width: 70px; height: 56px; border-radius: 10px; object-fit: cover; flex-shrink: 0; background: #f0e6d6; }
    .pkg-row-info { flex: 1; }
    .pkg-row-name { font-weight: 700; color: var(--dark); margin-bottom: 2px; }
    .pkg-row-desc { font-size: 0.82rem; color: var(--muted); }
    .pkg-row-price { font-family: 'Playfair Display', serif; font-size: 1.2rem; color: var(--primary); font-weight: 900; white-space: nowrap; }

    /* CTA */
    .cta-box {
      background: linear-gradient(135deg, var(--primary), #d4640a);
      border-radius: 20px; padding: 2rem; text-align: center; color: #fff;
      margin-bottom: 1.5rem;
    }
    .cta-box h3 { font-family: 'Playfair Display', serif; font-size: 1.5rem; margin-bottom: 0.5rem; }
    .cta-box p { opacity: 0.9; margin-bottom: 1.5rem; }
    .cta-btns { display: flex; gap: 1rem; justify-content: center; flex-wrap: wrap; }
    .cta-btn {
      padding: 0.8rem 1.8rem; border-radius: 10px;
      font-weight: 700; font-size: 1rem; text-decoration: none;
      display: inline-flex; align-items: center; gap: 6px;
      transition: all 0.2s;
    }
    .cta-wa { background: #25d366; color: #fff; }
    .cta-wa:hover { background: #1ebe5d; }
    .cta-call { background: rgba(255,255,255,0.2); color: #fff; border: 2px solid rgba(255,255,255,0.5); }
    .cta-call:hover { background: rgba(255,255,255,0.3); }

    /* NOT FOUND */
    .not-found { text-align: center; padding: 4rem 2rem; }
    .not-found h2 { font-family: 'Playfair Display', serif; font-size: 2rem; color: var(--dark); }
    .not-found p { color: var(--muted); margin-top: 0.5rem; }

    /* WA FLOAT */
    .wa-float { position: fixed; bottom: 24px; right: 24px; background: #25d366; color: #fff; width: 56px; height: 56px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 26px; text-decoration: none; box-shadow: 0 4px 20px rgba(37,211,102,0.5); z-index: 99; animation: pulse 2s infinite; }
    @keyframes pulse { 0%,100% { box-shadow: 0 4px 20px rgba(37,211,102,0.5); } 50% { box-shadow: 0 4px 40px rgba(37,211,102,0.8); } }

    .loading { text-align: center; padding: 4rem; color: var(--muted); }

    @media (max-width: 480px) { .taxi-specs { grid-template-columns: repeat(2,1fr); } .cta-btns { flex-direction: column; } }
  </style>
</head>
<body>

<div id="app"><div class="loading">‚è≥ Loading driver page...</div></div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-app.js";
  import { getDatabase, ref, onValue, query, orderByChild, equalTo } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-database.js";

  const firebaseConfig = {
    apiKey: "AIzaSyB0_DZfEQc_uQF2Dx8WmUt4WkJ0sY8Jai4",
    authDomain: "bhaskar-holidays.firebaseapp.com",
    databaseURL: "https://bhaskar-holidays-default-rtdb.firebaseio.com",
    projectId: "bhaskar-holidays",
    storageBucket: "bhaskar-holidays.firebasestorage.app",
    messagingSenderId: "1092104643884",
    appId: "1:1092104643884:web:42bf618858028b51b3b889"
  };

  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);

  const urlParams = new URLSearchParams(window.location.search);
  const pageId = parseInt(urlParams.get('id')) || 1;
  document.title = `Driver #${pageId} - Bhaskar Holidays`;

  let packagesData = {};

  // Load packages first
  onValue(ref(db, 'packages'), (pSnap) => {
    packagesData = pSnap.val() || {};
    loadDriver();
  }, { onlyOnce: true });

  function loadDriver() {
    onValue(ref(db, 'taxis'), (snap) => {
      const data = snap.val();
      const appEl = document.getElementById('app');

      if (!data) { renderNotFound(appEl); return; }

      // Find driver assigned to this page number
      const entry = Object.entries(data).find(([, d]) => d.pageNumber == pageId);

      if (!entry) { renderNotFound(appEl); return; }

      const [, driver] = entry;
      const waNum = driver.whatsapp || '919154095125';
      const avatar = driver.driverImage || `https://ui-avatars.com/api/?name=${encodeURIComponent(driver.driverName||'Driver')}&background=e8730a&color=fff&size=200`;

      appEl.innerHTML = `
        <!-- HEADER -->
        <div class="header">
          <div class="header-content">
            <div class="brand">Bhaskar <span>Holidays</span></div>
            <div class="driver-profile">
              <div class="driver-avatar-wrap">
                <img class="driver-avatar" src="${avatar}" alt="${driver.driverName}">
                <div class="driver-verified">‚úì</div>
              </div>
              <div class="driver-name">${driver.driverName}</div>
              <div class="driver-tagline">Your personal Goa tour guide üå¥</div>
              <div class="driver-badges">
                <span class="badge primary">Driver #${pageId}</span>
                <span class="badge">‚≠ê Verified</span>
                <span class="badge">${driver.type || 'Sedan'}</span>
                <span class="badge">üë• ${driver.capacity || 4} Seater</span>
                ${driver.ac ? '<span class="badge">‚ùÑÔ∏è AC</span>' : ''}
              </div>
            </div>
          </div>
        </div>

        <!-- MAIN -->
        <div class="main">

          <!-- TAXI SHOWCASE -->
          <div class="taxi-showcase">
            <div class="taxi-img-gallery">
              <img src="${driver.taxiImage || 'https://images.unsplash.com/photo-1609520505218-7421df820a28?w=700'}" alt="Taxi">
            </div>
            <div class="taxi-info">
              <div class="taxi-info-title">üöï My Taxi Details</div>
              <div class="taxi-specs">
                <div class="spec"><div class="spec-icon">üöó</div><div class="spec-value">${driver.type || 'Sedan'}</div><div class="spec-label">Vehicle Type</div></div>
                <div class="spec"><div class="spec-icon">üë•</div><div class="spec-value">${driver.capacity || 4}</div><div class="spec-label">Seater Capacity</div></div>
                <div class="spec"><div class="spec-icon">${driver.ac ? '‚ùÑÔ∏è' : 'üå¨Ô∏è'}</div><div class="spec-value">${driver.ac ? 'Yes' : 'No'}</div><div class="spec-label">Air Conditioning</div></div>
              </div>
              ${driver.taxiNumber ? `<div class="taxi-number-plate">üî¢ ${driver.taxiNumber}</div>` : ''}
            </div>
          </div>

          <!-- PACKAGES -->
          <div class="section-title">üó∫Ô∏è Available Tour Packages</div>
          <div class="pkg-list" id="pkg-list-section"></div>

          <!-- CTA -->
          <div class="cta-box">
            <h3>Ready to Explore Goa? üå¥</h3>
            <p>Book directly with ${driver.driverName} for a personalised tour experience.</p>
            <div class="cta-btns">
              <a class="cta-btn cta-wa" href="https://wa.me/${waNum}?text=Hi%20${encodeURIComponent(driver.driverName)}!%20I%20found%20your%20page%20on%20Bhaskar%20Holidays%20and%20want%20to%20book%20a%20Goa%20tour." target="_blank">üí¨ WhatsApp</a>
              <a class="cta-btn cta-call" href="tel:+${waNum}">üìû Call Now</a>
            </div>
          </div>
        </div>

        <!-- WA FLOAT -->
        <a class="wa-float" href="https://wa.me/${waNum}?text=Hi!%20I%20want%20to%20book%20a%20tour%20with%20${encodeURIComponent(driver.driverName)}." target="_blank">üí¨</a>
      `;

      // Render packages
      const pkgSection = document.getElementById('pkg-list-section');
      const pkgEntries = Object.entries(packagesData);
      if (pkgEntries.length === 0) {
        pkgSection.innerHTML = '<p style="color:var(--muted);text-align:center;padding:1rem;">No packages available yet.</p>';
      } else {
        pkgEntries.forEach(([, pkg]) => {
          const photos = pkg.photos ? Object.values(pkg.photos) : (pkg.image ? [pkg.image] : []);
          const thumb = photos[0] || 'https://images.unsplash.com/photo-1512343879784-a960bf40e7f2?w=200';
          const row = document.createElement('div');
          row.className = 'pkg-row';
          row.innerHTML = `
            <img class="pkg-row-img" src="${thumb}" alt="${pkg.name}">
            <div class="pkg-row-info">
              <div class="pkg-row-name">${pkg.name}</div>
              <div class="pkg-row-desc">${pkg.duration || ''} ${pkg.includes ? '‚Ä¢ ' + pkg.includes.split(',').slice(0,2).join(', ') : ''}</div>
            </div>
            <div>
              <div class="pkg-row-price">‚Çπ${pkg.price}</div>
              <a href="https://wa.me/${waNum}?text=Hi%20${encodeURIComponent(driver.driverName)}!%20I%20want%20to%20book%20the%20${encodeURIComponent(pkg.name)}%20package." target="_blank" style="display:block;text-align:center;margin-top:6px;background:var(--primary);color:#fff;padding:5px 12px;border-radius:8px;text-decoration:none;font-size:12px;font-weight:700;">Book</a>
            </div>
          `;
          pkgSection.appendChild(row);
        });
      }

    }, { onlyOnce: true });
  }

  function renderNotFound(el) {
    el.innerHTML = `
      <div class="header" style="min-height:200px;display:flex;align-items:center;justify-content:center;">
        <div class="header-content">
          <div class="brand">Bhaskar <span>Holidays</span></div>
        </div>
      </div>
      <div class="main">
        <div class="not-found">
          <div style="font-size:4rem;margin-bottom:1rem;">üöï</div>
          <h2>Driver #${pageId} Not Found</h2>
          <p>This driver page hasn't been assigned yet.</p>
          <br>
          <a href="index.html" style="color:var(--primary);font-weight:700;text-decoration:none;">‚Üê Back to Bhaskar Holidays</a>
        </div>
      </div>
    `;
  }
</script>
</body>
</html>
