<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Driver Page ‚Äî Bhaskar Holidays</title>
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700;900&family=DM+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    :root{ --primary:#e8730a; --dark:#1a1a2e; --light:#fff8f0; --muted:#64748b; --border:#ffe0c0; --green:#25d366; }
    *{ box-sizing:border-box; margin:0; padding:0; }
    body{ font-family:'DM Sans',sans-serif; background:var(--light); min-height:100vh; color:var(--dark); }

    /* HEADER */
    .header{ background:linear-gradient(135deg,#1a1a2e,#0f3460); padding:2.5rem 5%; color:#fff; position:relative; overflow:hidden; }
    .header::before{ content:''; position:absolute; inset:0; background:url('https://images.unsplash.com/photo-1512343879784-a960bf40e7f2?w=1200') center/cover; opacity:.1; }
    .header-content{ position:relative; max-width:800px; margin:0 auto; text-align:center; }
    .brand{ font-family:'Playfair Display',serif; font-size:1.1rem; color:rgba(255,255,255,.6); margin-bottom:1.5rem; letter-spacing:1px; }
    .brand span{ color:var(--primary); }
    .driver-profile{ display:flex; flex-direction:column; align-items:center; gap:1rem; }
    .driver-avatar-wrap{ position:relative; }
    .driver-avatar{ width:110px; height:110px; border-radius:50%; border:4px solid var(--primary); object-fit:cover; background:#f0e6d6; box-shadow:0 8px 32px rgba(0,0,0,.3); }
    .driver-verified{ position:absolute; bottom:4px; right:4px; background:var(--primary); color:#fff; border-radius:50%; width:26px; height:26px; display:flex; align-items:center; justify-content:center; font-size:14px; border:2px solid #fff; }
    .driver-name{ font-family:'Playfair Display',serif; font-size:2rem; }
    .driver-tagline{ color:rgba(255,255,255,.7); font-size:.95rem; }
    .driver-badges{ display:flex; gap:.75rem; flex-wrap:wrap; justify-content:center; margin-top:.5rem; }
    .badge{ background:rgba(255,255,255,.1); border:1px solid rgba(255,255,255,.2); color:#fff; padding:5px 14px; border-radius:20px; font-size:.82rem; font-weight:600; }
    .badge.primary{ background:var(--primary); border-color:var(--primary); }

    .main{ max-width:800px; margin:0 auto; padding:2rem 5%; }
    .section-title{ font-family:'Playfair Display',serif; font-size:1.4rem; color:var(--dark); margin-bottom:1rem; display:flex; align-items:center; gap:.5rem; }

    /* TAXI SHOWCASE */
    .taxi-showcase{ background:#fff; border-radius:20px; border:1px solid var(--border); box-shadow:0 4px 24px rgba(0,0,0,.07); overflow:hidden; margin-bottom:1.5rem; }
    .taxi-img{ width:100%; height:220px; object-fit:cover; background:#f0e6d6; display:block; }
    .taxi-info{ padding:1.5rem; }
    .taxi-info-title{ font-family:'Playfair Display',serif; font-size:1.3rem; color:var(--dark); margin-bottom:1rem; }
    .taxi-specs{ display:grid; grid-template-columns:repeat(3,1fr); gap:1rem; }
    .spec{ text-align:center; padding:1rem; background:var(--light); border-radius:12px; border:1px solid var(--border); }
    .spec-icon{ font-size:1.5rem; margin-bottom:.25rem; }
    .spec-value{ font-weight:700; color:var(--dark); font-size:.95rem; }
    .spec-label{ color:var(--muted); font-size:.78rem; }
    .taxi-number-plate{ margin-top:1rem; background:var(--dark); color:#fff; padding:.6rem 1.2rem; border-radius:8px; font-weight:700; font-size:1rem; display:inline-block; letter-spacing:2px; }

    /* DRIVER GALLERY */
    .gallery-section{ background:#fff; border-radius:20px; border:1px solid var(--border); padding:1.5rem; margin-bottom:1.5rem; }
    .gallery-grid{ display:grid; grid-template-columns:repeat(3,1fr); gap:8px; }
    .gallery-grid img{ width:100%; height:100px; object-fit:cover; border-radius:10px; cursor:pointer; transition:transform .2s,opacity .2s; }
    .gallery-grid img:hover{ transform:scale(1.03); opacity:.9; }

    /* PACKAGE CARD */
    .pkg-card{ background:#fff; border-radius:18px; border:1px solid var(--border); overflow:hidden; margin-bottom:1.2rem; box-shadow:0 4px 16px rgba(0,0,0,.06); transition:transform .2s; }
    .pkg-card:hover{ transform:translateY(-3px); }
    .pkg-img-wrap{ position:relative; height:180px; background:#f0e6d6; overflow:hidden; }
    .pkg-img-wrap img{ position:absolute; inset:0; width:100%; height:100%; object-fit:cover; opacity:0; transition:opacity .5s; }
    .pkg-img-wrap img.active{ opacity:1; }
    .pg-btn{ position:absolute; top:50%; transform:translateY(-50%); background:rgba(255,255,255,.85); border:none; border-radius:50%; width:28px; height:28px; cursor:pointer; font-size:14px; display:flex; align-items:center; justify-content:center; z-index:2; }
    .pg-prev{ left:8px; } .pg-next{ right:8px; }
    .pkg-cat-badge{ position:absolute; top:12px; left:12px; background:var(--primary); color:#fff; padding:4px 10px; border-radius:20px; font-size:11px; font-weight:700; }
    .pkg-body{ padding:1.2rem; }
    .pkg-name{ font-family:'Playfair Display',serif; font-size:1.2rem; color:var(--dark); margin-bottom:.4rem; }
    .pkg-desc{ color:var(--muted); font-size:.88rem; line-height:1.6; margin-bottom:.75rem; }
    .pkg-tags{ display:flex; flex-wrap:wrap; gap:6px; margin-bottom:.75rem; }
    .pkg-tag{ background:#fff3e0; color:var(--primary); font-size:11px; font-weight:600; padding:3px 9px; border-radius:6px; }
    .pkg-meta{ display:flex; gap:1rem; font-size:.82rem; color:var(--muted); margin-bottom:.75rem; }
    .pkg-footer{ display:flex; align-items:center; justify-content:space-between; flex-wrap:wrap; gap:.75rem; }
    .pkg-price{ font-family:'Playfair Display',serif; font-size:1.5rem; color:var(--primary); font-weight:900; }
    .pkg-price small{ font-size:.7rem; color:var(--muted); font-family:'DM Sans',sans-serif; font-weight:400; }
    .pkg-actions{ display:flex; flex-direction:column; gap:6px; }

    /* BOOK BUTTONS */
    .book-btn{ padding:8px 14px; border-radius:8px; font-weight:700; font-size:12px; text-decoration:none; display:flex; align-items:center; gap:5px; justify-content:center; transition:.2s; border:none; cursor:pointer; font-family:'DM Sans',sans-serif; }
    .book-driver{ background:var(--green); color:#fff; } .book-driver:hover{ background:#1ebe5d; }
    .book-admin{ background:var(--primary); color:#fff; } .book-admin:hover{ background:#d4640a; }

    /* VIEW DETAILS BUTTON */
    .view-details-btn{ padding:8px 16px; border-radius:8px; background:#eff6ff; color:#1d4ed8; border:1.5px solid #bfdbfe; font-weight:700; font-size:12px; cursor:pointer; font-family:'DM Sans',sans-serif; transition:.2s; display:flex; align-items:center; gap:5px; }
    .view-details-btn:hover{ background:#dbeafe; }

    /* CTA BOX */
    .cta-box{ background:linear-gradient(135deg,var(--primary),#d4640a); border-radius:20px; padding:2rem; text-align:center; color:#fff; margin-bottom:1.5rem; }
    .cta-box h3{ font-family:'Playfair Display',serif; font-size:1.5rem; margin-bottom:.5rem; }
    .cta-box p{ opacity:.9; margin-bottom:1.5rem; font-size:.95rem; }
    .cta-btns{ display:flex; gap:.75rem; justify-content:center; flex-wrap:wrap; }
    .cta-btn{ padding:.8rem 1.6rem; border-radius:10px; font-weight:700; font-size:.95rem; text-decoration:none; display:inline-flex; align-items:center; gap:6px; transition:.2s; }
    .cta-wa-d{ background:var(--green); color:#fff; } .cta-wa-d:hover{ background:#1ebe5d; }
    .cta-wa-a{ background:rgba(255,255,255,.2); color:#fff; border:2px solid rgba(255,255,255,.5); } .cta-wa-a:hover{ background:rgba(255,255,255,.3); }
    .cta-call{ background:rgba(255,255,255,.15); color:#fff; border:2px solid rgba(255,255,255,.3); } .cta-call:hover{ background:rgba(255,255,255,.25); }

    /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
       PLACES POPUP MODAL
    ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
    .places-modal-bg{
      display:none; position:fixed; inset:0;
      background:rgba(0,0,0,.65); z-index:1000;
      justify-content:center; align-items:flex-end;
      backdrop-filter:blur(4px);
    }
    .places-modal-bg.open{ display:flex; }
    .places-modal{
      background:#fff; border-radius:24px 24px 0 0;
      width:100%; max-width:640px; margin:0 auto;
      max-height:90vh; overflow-y:auto;
      box-shadow:0 -8px 40px rgba(0,0,0,.2);
      animation:slideUp .35s cubic-bezier(.25,.8,.25,1);
    }
    @media(min-width:680px){
      .places-modal-bg{ align-items:center; padding:1rem; }
      .places-modal{ border-radius:24px; max-height:88vh; }
    }
    @keyframes slideUp{ from{ transform:translateY(100%); opacity:0; } to{ transform:translateY(0); opacity:1; } }

    /* Modal header */
    .pm-header{
      position:sticky; top:0; background:#fff; z-index:2;
      padding:1.2rem 1.5rem 1rem;
      border-bottom:1px solid var(--border);
      display:flex; align-items:flex-start; justify-content:space-between; gap:1rem;
    }
    .pm-header-left{}
    .pm-pkg-badge{ display:inline-block; background:#fff3e0; color:var(--primary); font-size:10px; font-weight:700; text-transform:uppercase; letter-spacing:.5px; padding:2px 8px; border-radius:12px; margin-bottom:4px; }
    .pm-pkg-name{ font-family:'Playfair Display',serif; font-size:1.3rem; color:var(--dark); line-height:1.2; }
    .pm-pkg-meta{ display:flex; gap:.75rem; margin-top:6px; flex-wrap:wrap; }
    .pm-meta-chip{ background:var(--light); border:1px solid var(--border); padding:3px 10px; border-radius:20px; font-size:12px; font-weight:600; color:var(--dark); }
    .pm-close{ background:#f1f5f9; border:none; width:34px; height:34px; border-radius:50%; font-size:18px; cursor:pointer; flex-shrink:0; display:flex; align-items:center; justify-content:center; }
    .pm-close:hover{ background:#e2e8f0; }

    /* Modal body */
    .pm-body{ padding:1.5rem; }

    /* Places list */
    .pm-places-title{ font-size:11px; font-weight:700; text-transform:uppercase; letter-spacing:.5px; color:var(--muted); margin-bottom:1rem; }
    .pm-places-list{ display:flex; flex-direction:column; gap:1rem; }

    /* Each place card */
    .pm-place{
      display:flex; gap:1rem; align-items:flex-start;
      background:var(--light); border:1px solid var(--border);
      border-radius:16px; padding:1rem; overflow:hidden;
      transition:transform .2s, box-shadow .2s;
    }
    .pm-place:hover{ transform:translateY(-2px); box-shadow:0 6px 20px rgba(232,115,10,.12); }
    .pm-place-img{
      width:90px; height:80px; object-fit:cover;
      border-radius:12px; flex-shrink:0; background:#f0e6d6;
      cursor:pointer; transition:transform .2s;
    }
    .pm-place-img:hover{ transform:scale(1.05); }
    .pm-place-info{ flex:1; }
    .pm-place-num{ font-size:10px; font-weight:700; color:var(--primary); text-transform:uppercase; letter-spacing:.5px; margin-bottom:3px; }
    .pm-place-name{ font-family:'Playfair Display',serif; font-size:1.05rem; color:var(--dark); margin-bottom:4px; }
    .pm-place-desc{ font-size:.83rem; color:var(--muted); line-height:1.6; }

    /* No places state */
    .pm-no-places{ text-align:center; padding:2.5rem 1rem; color:var(--muted); }
    .pm-no-places .icon{ font-size:3rem; margin-bottom:.75rem; }

    /* Booking row at bottom of modal */
    .pm-book-row{
      position:sticky; bottom:0; background:#fff;
      padding:1rem 1.5rem; border-top:1px solid var(--border);
      display:flex; gap:.75rem; flex-wrap:wrap;
    }
    .pm-book-btn{ flex:1; min-width:130px; padding:.75rem 1rem; border-radius:10px; font-weight:700; font-size:.88rem; text-decoration:none; display:flex; align-items:center; justify-content:center; gap:6px; transition:.2s; border:none; cursor:pointer; font-family:'DM Sans',sans-serif; }
    .pm-book-driver{ background:var(--green); color:#fff; } .pm-book-driver:hover{ background:#1ebe5d; }
    .pm-book-admin{ background:var(--primary); color:#fff; } .pm-book-admin:hover{ background:#d4640a; }

    /* LIGHTBOX */
    .lightbox{ display:none; position:fixed; inset:0; background:rgba(0,0,0,.93); z-index:2000; justify-content:center; align-items:center; flex-direction:column; gap:1rem; }
    .lightbox.open{ display:flex; }
    .lightbox img{ max-width:92vw; max-height:82vh; border-radius:12px; object-fit:contain; }
    .lb-close{ position:absolute; top:16px; right:20px; background:none; border:none; color:#fff; font-size:32px; cursor:pointer; }
    .lb-nav{ display:flex; gap:1rem; }
    .lb-nav button{ background:rgba(255,255,255,.15); color:#fff; border:none; border-radius:8px; padding:8px 20px; font-size:18px; cursor:pointer; }

    /* WA FLOAT */
    .wa-float{ position:fixed; bottom:24px; right:24px; background:var(--green); color:#fff; width:58px; height:58px; border-radius:50%; display:flex; align-items:center; justify-content:center; font-size:26px; text-decoration:none; box-shadow:0 4px 20px rgba(37,211,102,.5); z-index:99; animation:pulse 2s infinite; }
    @keyframes pulse{ 0%,100%{ box-shadow:0 4px 20px rgba(37,211,102,.5); } 50%{ box-shadow:0 4px 40px rgba(37,211,102,.8); } }

    .not-found{ text-align:center; padding:4rem 2rem; }
    .not-found h2{ font-family:'Playfair Display',serif; font-size:2rem; color:var(--dark); }
    .not-found p{ color:var(--muted); margin-top:.5rem; }
    .loading{ text-align:center; padding:4rem; color:var(--muted); font-size:1.1rem; }

    @media(max-width:480px){
      .taxi-specs{ grid-template-columns:repeat(2,1fr); }
      .cta-btns{ flex-direction:column; }
      .gallery-grid{ grid-template-columns:repeat(2,1fr); }
      .pm-place-img{ width:70px; height:65px; }
    }
  </style>
</head>
<body>

<div id="app"><div class="loading">‚è≥ Loading...</div></div>

<!-- PLACES POPUP MODAL -->
<div class="places-modal-bg" id="places-modal">
  <div class="places-modal" id="places-modal-inner">
    <div class="pm-header">
      <div class="pm-header-left">
        <div class="pm-pkg-badge" id="pm-badge"></div>
        <div class="pm-pkg-name" id="pm-pkg-name"></div>
        <div class="pm-pkg-meta" id="pm-pkg-meta"></div>
      </div>
      <button class="pm-close" onclick="closePlacesModal()">‚úï</button>
    </div>
    <div class="pm-body">
      <div class="pm-places-title">üèñÔ∏è Places You'll Visit</div>
      <div class="pm-places-list" id="pm-places-list"></div>
    </div>
    <div class="pm-book-row" id="pm-book-row"></div>
  </div>
</div>

<!-- LIGHTBOX -->
<div class="lightbox" id="lightbox">
  <button class="lb-close" onclick="closeLb()">‚úï</button>
  <img id="lb-img" src="" alt="">
  <div class="lb-nav">
    <button onclick="lbNav(-1)">‚Äπ</button>
    <button onclick="lbNav(1)">‚Ä∫</button>
  </div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-app.js";
import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyB0_DZfEQc_uQF2Dx8WmUt4WkJ0sY8Jai4",
  authDomain: "bhaskar-holidays.firebaseapp.com",
  databaseURL: "https://bhaskar-holidays-default-rtdb.firebaseio.com",
  projectId: "bhaskar-holidays",
  storageBucket: "bhaskar-holidays.firebasestorage.app",
  messagingSenderId: "1092104643884",
  appId: "1:1092104643884:web:42bf618858028b51b3b889"
};
const app = initializeApp(firebaseConfig);
const db = getDatabase(app);
const ADMIN_WA = '919154095125';

const pageId = parseInt(new URLSearchParams(window.location.search).get('id')) || 1;
document.title = `Driver #${pageId} ‚Äî Bhaskar Holidays`;

// ‚îÄ‚îÄ LIGHTBOX ‚îÄ‚îÄ
let lbImgs=[], lbIdx=0;
window.openLb = (imgs,idx) => { lbImgs=imgs; lbIdx=idx; document.getElementById('lb-img').src=lbImgs[lbIdx]; document.getElementById('lightbox').classList.add('open'); };
window.closeLb = () => document.getElementById('lightbox').classList.remove('open');
window.lbNav = d => { lbIdx=(lbIdx+d+lbImgs.length)%lbImgs.length; document.getElementById('lb-img').src=lbImgs[lbIdx]; };

// ‚îÄ‚îÄ PKG IMAGE CAROUSEL ‚îÄ‚îÄ
const pgCur={};
window.pgNav = (id,dir,total) => {
  if(pgCur[id]===undefined) pgCur[id]=0;
  const wrap=document.getElementById('pg-'+id);
  const imgs=wrap.querySelectorAll('img');
  imgs[pgCur[id]].classList.remove('active');
  pgCur[id]=(pgCur[id]+dir+total)%total;
  imgs[pgCur[id]].classList.add('active');
};

// ‚îÄ‚îÄ PLACES POPUP ‚îÄ‚îÄ
window.openPlacesModal = (pkg, driverWa, driverName) => {
  const places = pkg.places ? Object.values(pkg.places) : [];

  // Header
  document.getElementById('pm-badge').textContent = pkg.category || 'üå¥ Tour Package';
  document.getElementById('pm-pkg-name').textContent = pkg.name || '';
  const meta = document.getElementById('pm-pkg-meta');
  meta.innerHTML = '';
  if(pkg.duration) meta.innerHTML += `<span class="pm-meta-chip">üïê ${pkg.duration}</span>`;
  if(pkg.price) meta.innerHTML += `<span class="pm-meta-chip">üí∞ ‚Çπ${pkg.price}/person</span>`;
  if(places.length) meta.innerHTML += `<span class="pm-meta-chip">üèñÔ∏è ${places.length} places</span>`;

  // Places list
  const list = document.getElementById('pm-places-list');
  list.innerHTML = '';
  if(places.length === 0){
    list.innerHTML = `<div class="pm-no-places"><div class="icon">üèñÔ∏è</div><p>Places will be added soon.</p></div>`;
  } else {
    places.forEach((pl, i) => {
      const div = document.createElement('div');
      div.className = 'pm-place';
      div.innerHTML = `
        <img class="pm-place-img" src="${pl.image||''}" alt="${pl.name||''}"
          onerror="this.style.background='#f0e6d6'"
          onclick="openLb(${JSON.stringify(places.filter(p=>p.image).map(p=>p.image))}, ${places.filter(p=>p.image).findIndex(p=>p===pl)})">
        <div class="pm-place-info">
          <div class="pm-place-num">üìç Stop ${i+1}</div>
          <div class="pm-place-name">${pl.name||'Unknown Place'}</div>
          ${pl.desc ? `<div class="pm-place-desc">${pl.desc}</div>` : ''}
        </div>
      `;
      list.appendChild(div);
    });
  }

  // Book row
  const bookRow = document.getElementById('pm-book-row');
  const pkgMsg = encodeURIComponent(`Hi ${driverName}! I want to book the "${pkg.name}" package. Please confirm.`);
  const adminMsg = encodeURIComponent(`Hi! Booking "${pkg.name}" with driver ${driverName} (Page #${pageId}).`);
  bookRow.innerHTML = `
    <a class="pm-book-btn pm-book-driver" href="https://wa.me/${driverWa}?text=${pkgMsg}" target="_blank">üí¨ Book with Driver</a>
    <a class="pm-book-btn pm-book-admin" href="https://wa.me/${ADMIN_WA}?text=${adminMsg}" target="_blank">üìã Book via Admin</a>
  `;

  document.getElementById('places-modal').classList.add('open');
  document.body.style.overflow = 'hidden';
};

window.closePlacesModal = () => {
  document.getElementById('places-modal').classList.remove('open');
  document.body.style.overflow = '';
};

// Close on background tap
document.getElementById('places-modal').addEventListener('click', e => {
  if(e.target === document.getElementById('places-modal')) closePlacesModal();
});

// ‚îÄ‚îÄ MAIN LOAD ‚îÄ‚îÄ
let pkgsData={}, driverData=null, loaded=false;

function tryRender(){
  if(loaded || !driverData || Object.keys(pkgsData).length === 0 && pkgsData.__checked) renderPage();
}

onValue(ref(db,'packages'), snap => {
  pkgsData = snap.val() || {};
  pkgsData.__checked = true;
  if(driverData) renderPage();
}, { onlyOnce:true });

onValue(ref(db,'taxis'), snap => {
  const data=snap.val();
  const appEl=document.getElementById('app');
  if(!data){ renderNotFound(appEl); return; }
  const entry=Object.entries(data).find(([,d])=>d.pageNumber==pageId);
  if(!entry){ renderNotFound(appEl); return; }
  driverData=entry[1];
  if(pkgsData.__checked) renderPage();
}, { onlyOnce:true });

function renderPage(){
  if(loaded) return; loaded=true;
  const driver=driverData;
  const appEl=document.getElementById('app');
  const driverWa=driver.whatsapp||ADMIN_WA;
  const avatar=driver.driverImage||`https://ui-avatars.com/api/?name=${encodeURIComponent(driver.driverName||'Driver')}&background=e8730a&color=fff&size=200`;
  const galleryPhotos=driver.gallery?Object.values(driver.gallery):[];
  const waMsg=encodeURIComponent(`Hi ${driver.driverName}! I found your page on Bhaskar Holidays and want to book a tour.`);
  const adminMsg=encodeURIComponent(`Hi! I want to book a tour with driver ${driver.driverName} (Page #${pageId}).`);

  appEl.innerHTML = `
    <div class="header">
      <div class="header-content">
        <div class="brand">Bhaskar <span>Holidays</span></div>
        <div class="driver-profile">
          <div class="driver-avatar-wrap">
            <img class="driver-avatar" src="${avatar}" alt="${driver.driverName}" onerror="this.src='https://ui-avatars.com/api/?name=${encodeURIComponent(driver.driverName||'D')}&background=e8730a&color=fff&size=200'">
            <div class="driver-verified">‚úì</div>
          </div>
          <div class="driver-name">${driver.driverName}</div>
          <div class="driver-tagline">Your personal Goa tour guide üå¥</div>
          <div class="driver-badges">
            <span class="badge primary">Driver #${pageId}</span>
            <span class="badge">‚≠ê Verified</span>
            <span class="badge">${driver.type||'Taxi'}</span>
            <span class="badge">üë• ${driver.capacity||4} Seater</span>
            ${driver.ac?'<span class="badge">‚ùÑÔ∏è AC</span>':''}
          </div>
        </div>
      </div>
    </div>

    <div class="main">

      <!-- TAXI -->
      <div class="taxi-showcase">
        <img class="taxi-img" src="${driver.taxiImage||''}" alt="Taxi" onerror="this.style.background='#f0e6d6'">
        <div class="taxi-info">
          <div class="taxi-info-title">üöï My Taxi Details</div>
          <div class="taxi-specs">
            <div class="spec"><div class="spec-icon">üöó</div><div class="spec-value">${driver.type||'Taxi'}</div><div class="spec-label">Car Model</div></div>
            <div class="spec"><div class="spec-icon">üë•</div><div class="spec-value">${driver.capacity||4}</div><div class="spec-label">Seater</div></div>
            <div class="spec"><div class="spec-icon">${driver.ac?'‚ùÑÔ∏è':'üå¨Ô∏è'}</div><div class="spec-value">${driver.ac?'AC':'Non-AC'}</div><div class="spec-label">Comfort</div></div>
          </div>
          ${driver.taxiNumber?`<div class="taxi-number-plate">üî¢ ${driver.taxiNumber}</div>`:''}
        </div>
      </div>

      <!-- DRIVER GALLERY -->
      ${galleryPhotos.length>0?`
      <div class="gallery-section">
        <div class="section-title">üì∑ My Photo Gallery</div>
        <div class="gallery-grid" id="driver-gal"></div>
      </div>`:''}

      <!-- PACKAGES -->
      <div class="section-title">üó∫Ô∏è Tour Packages</div>
      <div id="pkg-section"></div>

      <!-- CTA -->
      <div class="cta-box">
        <h3>Ready to Explore Goa? üå¥</h3>
        <p>Book with ${driver.driverName} ‚Äî your message reaches both driver & admin instantly.</p>
        <div class="cta-btns">
          <a class="cta-btn cta-wa-d" href="https://wa.me/${driverWa}?text=${waMsg}" target="_blank">üí¨ WhatsApp Driver</a>
          <a class="cta-btn cta-wa-a" href="https://wa.me/${ADMIN_WA}?text=${adminMsg}" target="_blank">üìã WhatsApp Admin</a>
          <a class="cta-btn cta-call" href="tel:+${driverWa}">üìû Call Driver</a>
        </div>
      </div>
    </div>

    <a class="wa-float" href="https://wa.me/${driverWa}?text=${waMsg}" target="_blank" title="Chat with Driver">üí¨</a>
  `;

  // Driver gallery
  if(galleryPhotos.length>0){
    const galGrid=document.getElementById('driver-gal');
    galleryPhotos.forEach((url,i)=>{
      const img=document.createElement('img');
      img.src=url; img.alt='';
      img.onerror=()=>img.style.background='#f0e6d6';
      img.onclick=()=>openLb(galleryPhotos,i);
      galGrid.appendChild(img);
    });
  }

  // Packages
  const pkgSection=document.getElementById('pkg-section');
  const pkgEntries=Object.entries(pkgsData).filter(([k])=>k!=='__checked');
  if(pkgEntries.length===0){
    pkgSection.innerHTML='<p style="color:var(--muted);text-align:center;padding:1.5rem;background:#fff;border-radius:14px;">No packages yet.</p>';
    return;
  }

  pkgEntries.forEach(([pkgId,pkg])=>{
    const photos=pkg.photos?Object.values(pkg.photos):(pkg.image?[pkg.image]:[]);
    const includes=pkg.includes?pkg.includes.split(',').map(t=>t.trim()).filter(Boolean):[];
    const placesArr=pkg.places?Object.values(pkg.places):[];
    const pkgWaMsg=encodeURIComponent(`Hi ${driver.driverName}! I want the "${pkg.name}" package. Please confirm.`);
    const pkgAdminMsg=encodeURIComponent(`Hi! Booking "${pkg.name}" with driver ${driver.driverName} (Page #${pageId}).`);

    // Serialise pkg safely for onclick
    const pkgJson=JSON.stringify(pkg).replace(/'/g,"\\'");

    const card=document.createElement('div');
    card.className='pkg-card';
    card.innerHTML=`
      <div class="pkg-img-wrap" id="pg-${pkgId}">
        ${photos.length>0
          ? photos.map((u,i)=>`<img src="${u}" class="${i===0?'active':''}" alt="${pkg.name}" onerror="this.style.background='#f0e6d6'">`).join('')
          : '<img src="" class="active" style="background:#f0e6d6;" alt="">'
        }
        ${photos.length>1?`<button class="pg-btn pg-prev" onclick="pgNav('${pkgId}',-1,${photos.length})">‚Äπ</button><button class="pg-btn pg-next" onclick="pgNav('${pkgId}',1,${photos.length})">‚Ä∫</button>`:''}
        ${pkg.category?`<div class="pkg-cat-badge">${pkg.category}</div>`:''}
      </div>
      <div class="pkg-body">
        <div class="pkg-name">${pkg.name}</div>
        <div class="pkg-meta">
          ${pkg.duration?`<span>üïê ${pkg.duration}</span>`:''}
          ${placesArr.length>0?`<span>üèñÔ∏è ${placesArr.length} places</span>`:''}
        </div>
        ${pkg.description?`<div class="pkg-desc">${pkg.description}</div>`:''}
        ${includes.length>0?`<div class="pkg-tags">${includes.map(t=>`<span class="pkg-tag">‚úì ${t}</span>`).join('')}</div>`:''}
        <div class="pkg-footer">
          <div class="pkg-price">‚Çπ${pkg.price||'‚Äî'} <small>/person</small></div>
          <div class="pkg-actions">
            <button class="view-details-btn" onclick='openPlacesModal(${pkgJson},"${driverWa}","${driver.driverName}")'>üèñÔ∏è View Places</button>
            <a class="book-btn book-driver" href="https://wa.me/${driverWa}?text=${pkgWaMsg}" target="_blank">üí¨ Book with Driver</a>
            <a class="book-btn book-admin" href="https://wa.me/${ADMIN_WA}?text=${pkgAdminMsg}" target="_blank">üìã Book via Admin</a>
          </div>
        </div>
      </div>
    `;
    pkgSection.appendChild(card);
  });
}

function renderNotFound(el){
  el.innerHTML=`
    <div class="header" style="min-height:180px;display:flex;align-items:center;justify-content:center;">
      <div class="header-content"><div class="brand">Bhaskar <span>Holidays</span></div></div>
    </div>
    <div class="main">
      <div class="not-found">
        <div style="font-size:4rem;margin-bottom:1rem;">üöï</div>
        <h2>Driver #${pageId} Not Found</h2>
        <p>This page hasn't been assigned yet.</p>
        <br>
        <a href="index.html" style="color:var(--primary);font-weight:700;text-decoration:none;">‚Üê Back to Bhaskar Holidays</a>
      </div>
    </div>`;
}
</script>
</body>
</html>
